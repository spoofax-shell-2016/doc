\section{Requirements Analysis}
\label{sec:requirement-analysis}

Defining requirements upfront is important for several reasons: it is a contract
between the developers and the client, it guides the product development, it
enables the client to track the progress and finally it allows validation of the
deliverable. These requirements are listed in this section.

\subsection{Design goals}
\label{ssec:goals}

The client has expressed some high-level requirements, which are listed in this
subsection as design goals in order of priority. The design goals serve as an
important guideline when defining and implement the invidual requirements. As
such, they can be considered the bounds within which all requirements must fit.

\paragraph{Language-agnostic} The REPL should work with all languages
defined with Spoofax. This means that no assumptions can be made about any
language constructs or syntax.

\paragraph{Autogeneration} The REPL should be automatically provided, just like
all of Spoofax's other services. This means that providing access to the shell
should be integrated into Spoofax's build system and not require any additional
steps from the user.

\paragraph{Maintainability} Spoofax is an already existing, open source project
managed by several people. When the product is delivered, it will have to be
maintained by others. Therefore, it is important that the code is maintainable.

\paragraph{Performance} Spoofax's developers already focus quite a bit on
performance: both the generation and the use of the services are performant.
This should be no different for the REPL.

\paragraph{Modify Spoofax's existing codebase as little as possible} The product
should be an extension to Spoofax, which means the changes made to the existing
Spoofax codebase should be as small as possible. Preferably, the REPL service
should be a standalone module.

\subsection{Requirements}
\label{ssec:requirements}

Under the guidance of the design goals listed in the previous subsection, the
requirements compiled from the feature matrix discussed in \cref{sec:repl} and
meetings with the client are discussed below, under the MoSCoW method.

\subsubsection{Must have}

Requirements listed under ``must haves'' are of critical importance to the
usability and success of the deliverable. Without these, the product is not in a
workable state and is not likely to be accepted by the client. \emph{Must} can
also be considered an acronym for the Minimum Usable SubseT.

\paragraph{Interactive shell} Per the definition of a REPL given in
\cref{sec:repl}, the REPL has to be interactive. It should evaluate single
statements and expressions typed in by the user and print the results back to
them.

\paragraph{Operates with language definition} Every service in Spoofax operates
from language definitions. It is evident that the REPL should work with these
definitions if it is to fit within Spoofax.

\paragraph{Input \& output history} Users should be able to retrieve previously
typed expressions and statements to support the explorative and interactive
nature of a REPL. In the same vein, previously yielded results should be
implicitly bound to automatically generated names to make their values available
in future expressions.

\paragraph{Multiline input editing} Most, if not all, modern languages benefit
by structuring their constructs over multine lines. Multiline input editing is
therefore a crucial feature for user satisfaction. The input editor should
start in single line editing mode and recognise when an expression or statement
is part of a multiline construction. When it recognises this, it should
automatically switch to its multiline input editing mode, wherein the
prompt character indicates this new mode. This mode's behavior (e.g. keyboard
shortcuts) is different from the single line editing mode.

\paragraph{Error reporting} To support the interactivity of the REPL, error
reporting should be available in two ways: while typing an expression or a
statement, on-the-fly error reporting should indicate wrongly typed items. The
interpreter that evaluates syntactically correct input should also be able to
display its error messages to the user in case of an error during the dynamic
semantics phase.

\paragraph{Syntax checked input} Supporting the above requirement, all
input should have its syntax checked on the fly.

\paragraph{Syntax highlighting} All expressions and statements (whether they are
currently being entered, displayed as previously entered input or displayed as
previously yieled results) should be syntax highlighted.

\paragraph{Integration with Eclipse} As first implementation, the REPL should
integrate with Eclipse to provide an interface to the users. It is important to
note that while integration with Eclipse is a requirement, Spoofax itself is
moving to be IDE-agnostic. As such, the implementation of the REPL's core
should not be tied to Eclipse.

\subsubsection{Should have}

Requirements listed under ``should-haves'' are important, but not necessary for
a working product.

\paragraph{Ability to redefine identifiers} As explained in \cref{sec:repl},
REPLs provide the ability to explore unknown problem domains. It is not a
far-fetched idea that a developer would want to change function implementations
or the types of certain variables. To support this, a REPL should allow users to
redefine identifiers. This might mean that the REPL needs different semantics
than the language it operates on, slightly contrasting the requirement that the
REPLs should be language-agnostic.

\paragraph{Environment inspection} The argument of the previous requirements can
be repeated for this one: the exploratory and interactive nature of REPLs call
for the ability to inspect the current environment. This is to replace the files
with source code that a developer could otherwise inspect and an initial step
towards offering debugging features in a REPL.

\paragraph{Save and load REPL state} Often, developers want to save the current
state of their IDE and return to it later. As such, the REPLs should allow their
state to be saved and restored.

\subsubsection{Could have}

Requirements listed under ``could-haves'' are desirable, but not necessary.
These requirements often improve usability or customer satisfaction and are
included only if time permits.

\paragraph{Context-sensitive code completion} The multiline input editor should
ideally function just like an IDE's editor. Context-sensitive code completion is
therefore a nice feature to offer the users. Context-sensitive code-completion
also helps with the discoverability of APIs and therefore is another step
towards the explorative and interactive environment a REPL is supposed to
provide.

\paragraph{Hover over variables to see value, type and others} Another step
towards debugging would be the ability to hover variables with the mouse in
order to inspect their value, type and other known information. The difference
between this feature and the previously mentioned environment inspection is that
this feature works per variable.

\paragraph{Literate programming} As explained in
\cref{sec:literate-programming}, literate programming offers the advantage that
code and documentation go hand in hand. This allows developers of languages in
Spoofax to document and illustrate their language simultaneously with the
development: documentation and examples can never be outdated, because outdated
example code will halt the execution.

\paragraph{Integration with other IDEs (IntelliJ)} As mentioned before, Spoofax
is currently undergoing a transition not to be tied to a specific IDE.
Generating Spoofax's editor services for IntelliJ is currently a work in
progress and it would be nice if the REPL works in IntelliJ from the start.

\subsubsection{Won't have}

Requirements listed under ``won't-haves'' are not for implementation in this
project. They have been identified as possible features, but are outside of the
scope of this project and listed only as possible suggestions for further work.

\paragraph{GDB-style debugging and nested REPLs} Spoofax currently does not
generate any debugging features, which would be required for REPLs to offer
such functionality as a built-in feature. Writing such a debugger is outside
the scope of this project and thus offering debugging capabilities inside
the REPLs is something to consider for a later version.

\subsection{Minimal viable product}
\label{ssec:mvp}

The design goals and requirements listed in the previous subsections give a good
idea of what the deliverable should look like. It is possible, however, that due
to unforeseen problems, not all the listed requirements and design goals can be
met. It is important to therefore define a minimal subset of the design goals
and requirements that \emph{must} be present in the final deliverable: the
``must have'' requirements have to be implemented, whilst adhering to the first
two design goals.

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "main"
%%% End:
